<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>租金區間試算表</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,"PingFang TC","Heiti TC",sans-serif;margin:20px}
    label{display:block;margin-top:10px;font-size:14px}
    input,select,button{padding:6px 10px;font-size:14px;margin-top:4px}
    button{cursor:pointer}
    fieldset{border:1px solid #ddd;border-radius:10px;padding:12px;margin-top:12px}
    legend{font-size:13px;color:#555;padding:0 6px}
    .result{margin-top:20px;font-size:40px;font-weight:bold}
    .ok{color:green}
    .warn{color:red}
    .detail{margin-top:8px;font-size:16px;color:#333;line-height:1.8}
    .bonus-block{border:2px solid #f39c12;background:#fff8e6;padding:10px;margin-top:15px;border-radius:8px}
    .muted{color:#666}
    .note{margin-top:20px;color:red;font-size:14px;font-weight:bold}
  </style>
</head>
<body>
  <h1>租金區間試算表</h1>

  <form id="rentForm">
    <label>行政區
      <select id="district" required>
        <option value="">— 請選擇 —</option>
        <option>西屯區</option><option>北屯區</option><option>南屯區</option>
        <option>北區</option><option>西區</option><option>中區</option><option>東區</option>
        <option>烏日區</option><option>南區</option><option>大里區</option><option>太平區</option>
        <option>潭子區</option><option>豐原區</option><option>后里區</option>
        <option>沙鹿區</option><option>龍井區</option><option>大肚區</option>
        <option>大雅區</option><option>神岡區</option><option>梧棲區</option>
        <option>清水區</option><option>大甲區</option><option>外埔區</option>
        <option>霧峰區</option><option>石岡區</option><option>東勢區</option>
        <option>新社區</option><option>和平區</option><option>其他</option>
      </select>
    </label>

    <label>是否為套房
      <select id="isStudio" required>
        <option value="">— 請選擇 —</option>
        <option value="yes">yes（套房）</option>
        <option value="no">no（非套房）</option>
      </select>
    </label>

    <label>屋齡（年）
      <input id="age" type="number" min="0" max="200" required>
    </label>

    <label>坪數（可輸入小數點兩位）
      <input id="pings" type="number" min="0" step="0.01" required>
    </label>

    <label>現在租金
      <input id="currentRent" type="number" min="0" step="1" required>
    </label>

    <fieldset>
      <legend>額外加分（另外顯示，不與原本金額混合）</legend>

      <label>裝潢
        <select id="deco">
          <option value="0">未裝潢（0%）</option>
          <option value="2.5">簡易裝潢（2.5%）</option>
          <option value="5">中等裝潢（5%）</option>
        </select>
      </label>

      <label>區位（生活機能指數，0–5%）
        <input id="areaPct" type="number" min="0" max="5" step="0.1" value="0">
      </label>

      <label>設備加分（元，依類型有上限：<span id="equipCapLabel">請先選擇是否為套房</span>）
        <input id="equip" type="number" min="0" step="1" value="0">
      </label>

      <div class="muted">說明：裝潢與區位以「最高租金」為基礎計算百分比，加分金額採整數（無條件進位）；設備加分依上限（套房 1000 / 非套房 2000）。</div>
    </fieldset>

    <button type="submit">送出</button>
  </form>

  <div id="result" class="result"></div>
  <div id="detail" class="detail"></div>
  <div id="note" class="note"></div>

<script>
// === 基礎資料 ===
const HOUSEHOLD = {"西屯區":780,"北屯區":750,"南屯區":750,"北區":740,"西區":740,"中區":690,"東區":690,"烏日區":690,"南區":650,
"大里區":620,"太平區":640,"潭子區":640,"豐原區":640,"后里區":560,"沙鹿區":560,"龍井區":560,"大肚區":550,
"大雅區":550,"神岡區":550,"梧棲區":500,"清水區":480,"大甲區":470,"外埔區":420,"霧峰區":420,"石岡區":410,
"東勢區":380,"新社區":380,"和平區":310,"其他":310};

const STUDIO = {"西屯區":930,"北屯區":880,"南屯區":870,"北區":870,"西區":830,"中區":840,"東區":840,"烏日區":820,"南區":820,
"大里區":740,"太平區":740,"潭子區":760,"豐原區":700,"后里區":740,"沙鹿區":740,"龍井區":690,"大肚區":700,
"大雅區":760,"神岡區":700,"梧棲區":690,"清水區":680,"大甲區":650,"外埔區":600,"霧峰區":600,"石岡區":600,
"東勢區":420,"新社區":400,"和平區":320,"其他":320};

// 調整率：可依需求更新
const ADJUST_RATES=[0.20,0.18,0.16,0.13,0.10,0.07,0.04,0.00,-0.05];

// 年限分段：0–4, 5–9, 10–14, 15–19, 20–24, 25–29, 30–34, 35–39, 40+
const BRACKETS=[4,9,14,19,24,29,34,39,200];
const BRACKET_LABELS=["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40+"];

function bracketIndex(age){
  for(let i=0;i<BRACKETS.length;i++){ if(age<=BRACKETS[i]) return i; }
  return BRACKETS.length-1;
}
function getRate(age){ return ADJUST_RATES[bracketIndex(age)]; }
function getBracketLabel(age){ return BRACKET_LABELS[bracketIndex(age)]; }

// 顯示設備上限標籤
const isStudioSel = document.getElementById('isStudio');
const equipCapLabel = document.getElementById('equipCapLabel');
isStudioSel.addEventListener('change', ()=>{
  const cap = isStudioSel.value==="yes" ? 1000 : (isStudioSel.value==="no" ? 2000 : null);
  equipCapLabel.textContent = cap ? `上限 ${cap.toLocaleString()} 元` : '請先選擇是否為套房';
});

document.getElementById("rentForm").addEventListener("submit", e=>{
  e.preventDefault();
  const dist=document.getElementById("district").value;
  const isStudio=document.getElementById("isStudio").value;
  const age=Number(document.getElementById("age").value);
  const pings=parseFloat(document.getElementById("pings").value);
  const current=Number(document.getElementById("currentRent").value);

  const decoPct=parseFloat(document.getElementById("deco").value)||0;
  let areaPct=parseFloat(document.getElementById("areaPct").value)||0;
  areaPct = Math.min(Math.max(areaPct,0),5);
  let equipInput = Number(document.getElementById("equip").value)||0;

  const resEl=document.getElementById("result");
  const detailEl=document.getElementById("detail");
  const noteEl=document.getElementById("note");

  // 上限規則：無法承作
  if(isStudio==="yes" && current>21000){
    resEl.textContent="無法承作";
    resEl.className="result warn";
    detailEl.innerHTML = `（套房上限 21,000，現在租金 <b>${current}</b> 元）`;
    noteEl.textContent="以上試算結果僅供參考，最後結果將由審查單位認定";
    return;
  }
  if(isStudio==="no" && current>35000){
    resEl.textContent="無法承作";
    resEl.className="result warn";
    detailEl.innerHTML = `（非套房上限 35,000，現在租金 <b>${current}</b> 元）`;
    noteEl.textContent="以上試算結果僅供參考，最後結果將由審查單位認定";
    return;
  }

  // 基本計算
  const base=(isStudio==="yes"?STUDIO[dist]:HOUSEHOLD[dist]); // 原始表數字
  const rate=getRate(age);                                     // 調等率（因屋齡）
  const band=Math.ceil(base*(1+rate));                         // 租金區間（進位）
  const highest=Math.ceil(band*pings);                         // 最高租金（進位）
  const pass = highest >= current;
  const label=`${getBracketLabel(age)} ${isStudio==="yes"?"套房":"非套房"}`;

  // 額外加分
  const decoBonus   = Math.ceil(highest * (decoPct/100));
  const areaBonus   = Math.ceil(highest * (areaPct/100));
  const equipCap    = isStudio==="yes" ? 1000 : 2000;
  const equipBonus  = Math.min(Math.ceil(Math.max(equipInput,0)), equipCap);
  const totalBonus  = decoBonus + areaBonus + equipBonus;

  const highestWithBonus = highest + totalBonus;
  const passWithBonus = highestWithBonus >= current;

  // O/X 結果
  resEl.textContent = pass ? "O" : "X";
  resEl.className   = "result " + (pass ? "ok" : "warn");

  // 詳細資訊（新增：租金區間表 & 調等率）
  let html =
    `對應分段：<b>${label}</b><br>`+
    `租金區間：<b>${band}</b><br>`+
    `租金區間表（原始基準）：<b>${base}</b><br>`+
    `調等率：<b>${(rate*100).toFixed(2)}%</b><br>`+
    (pass
      ? `現在租金：<b>${current}</b> 元`
      : `坪數：<b>${pings.toFixed(2)}</b><br>`+
        `最高租金（無條件進位）：<b>${highest}</b> 元<br>`+
        `現在租金：<b>${current}</b> 元`
    );

  // 額外加分區塊
  html +=
    `<div class="bonus-block">`+
    `<u>額外加分（不與原本金額混合）</u><br>`+
    `‧ 裝潢加分（${decoPct}%）：<b>${decoBonus}</b> 元<br>`+
    `‧ 區位加分（${areaPct}%）：<b>${areaBonus}</b> 元<br>`+
    `‧ 設備加分（上限 ${equipCap.toLocaleString()}）：<b>${equipBonus}</b> 元<br>`+
    `合計加分：<b>${totalBonus}</b> 元<br>`+
    `最高租金(含加分)：<b>${highestWithBonus}</b> 元<br>`+
    `加分後判斷：<b style="color:${passWithBonus?"green":"red"}">${passWithBonus?"O":"X"}</b>`+
    `</div>`;

  detailEl.innerHTML = html;
  noteEl.textContent="以上試算結果僅供參考，最後結果將由審查單位認定";
});
</script>
</body>
</html>
