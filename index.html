<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>租金區間試算表</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC",Arial;
  margin:20px;
}
label{display:block;margin-top:10px}
input,select,button{padding:6px 10px;font-size:14px;margin-top:4px}
button{cursor:pointer;margin-top:14px}
fieldset{border:1px solid #ccc;border-radius:10px;padding:12px;margin-top:12px}
legend{font-size:13px;color:#555}
.result{margin-top:20px;font-size:42px;font-weight:bold}
.ok{color:green}
.warn{color:red}
.detail{margin-top:10px;font-size:16px;line-height:1.8}
.bonus-box{
  border:2px solid #f39c12;
  background:#fff7e0;
  padding:12px;
  margin-top:12px;
  border-radius:8px;
}
.note{margin-top:18px;color:red;font-weight:bold}

/* tooltip */
.tooltip{position:relative;display:inline-block;color:#0077cc;font-weight:bold;cursor:pointer}
.tooltip span{
  visibility:hidden;
  opacity:0;
  width:340px;
  background:#333;
  color:#fff;
  padding:10px;
  border-radius:8px;
  position:absolute;
  top:25px;
  left:0;
  z-index:10;
  font-size:13px;
  line-height:1.6;
  transition:.25s;
}
.tooltip.show span{visibility:visible;opacity:1}
</style>
</head>

<body>
<h1>租金區間試算表</h1>

<form id="form">

<label>行政區
<select id="district" required>
<option value="">— 請選擇 —</option>
<option>西屯區</option>
<option>北屯區</option>
<option>南屯區</option>
<option>北區</option>
<option>西區</option>
<option>中區</option>
<option>東區</option>
<option>烏日區</option>
<option>南區</option>
<option>大里區</option>
<option>太平區</option>
<option>潭子區</option>
<option>豐原區</option>
<option>后里區</option>
<option>沙鹿區</option>
<option>龍井區</option>
<option>大肚區</option>
<option>大雅區</option>
<option>神岡區</option>
<option>梧棲區</option>
<option>清水區</option>
<option>大甲區</option>
<option>外埔區</option>
<option>霧峰區</option>
<option>石岡區</option>
<option>東勢區</option>
<option>新社區</option>
<option>其它</option>
</select>
</label>

<label>屋齡（年）
<input id="age" type="number" min="0" required>
</label>

<label>坪數（可小數）
<input id="ping" type="number" step="0.01" min="0" required>
</label>

<label>現在租金
<input id="rent" type="number" min="0" required>
</label>

<fieldset>
<legend>額外加分（僅於未通過時判斷）</legend>

<label>
室內裝修
<select id="deco">
<option value="0">未裝修（0%）</option>
<option value="3">簡易裝修（3%）</option>
<option value="5">中等裝修（5%）</option>
</select>
</label>

<label>
區位
<select id="area">
<option value="0">中下區位（0%）</option>
<option value="3">中上區位（3%）</option>
<option value="5">優質區位（5%）</option>
</select>
</label>

<label>
設備加分金額（會自動套用上限）
<input id="equip" type="number" min="0" value="0">
</label>

<div style="margin-top:8px">
<div class="tooltip">區位（0 / 3 / 5%）判斷條件 ℹ️
<span>
<b>表二 區位因素調整表</b><br><br>
<b>優質區位 5%</b>：核心生活圈，交通運輸便捷，生活機能完善或就業機會高度集中。<br><br>
<b>中上區位 3%</b>：一般主要生活圈，交通可及性佳，周邊設施水準中上或臨近特定產業區。<br><br>
<b>中下區位 0%</b>：非主要生活圈，交通便利性相對不足，周邊設施水準有限或就業機會分散。
</span>
</div><br>

<div class="tooltip">室內裝修（0 / 3 / 5%）判斷條件 ℹ️
<span>
<b>表三 室內裝修調整表</b><br><br>
<b>中等裝修 5%</b>：天花板有特殊設計，並具備系統櫃等收納機能，兼具舒適與美觀。<br><br>
<b>簡易裝修 3%</b>：天花板有基本油漆或整理，具備基本收納機能。<br><br>
<b>未裝修 0%</b>：僅提供基本居住功能，天花板無額外整理。
</span>
</div><br>

<div class="tooltip">設備上限（1,000 / 2,000）判斷條件 ℹ️
<span>
<b>設備調整值（ΔE）</b><br><br>
案件提供之設備項目優於一般租賃市場水準，例如：冷氣、冰箱、洗衣機、床組等。<br><br>
<b>套房最高上限：1,000 元／月</b><br>
<b>非套房最高上限：2,000 元／月</b><br><br>
設備加分金額不得超過上述上限。
</span>
</div>
</div>

</fieldset>

<button type="submit">送出試算</button>
</form>

<div id="result" class="result"></div>
<div id="detail" class="detail"></div>
<div class="note">以上試算結果僅供參考，最後結果將由審查單位認定</div>

<script>
// ===== 單價表（已依官方表逐列核對） =====
const STUDIO_TABLE = {
"西屯區":[1120,1100,1080,1055,1025,1000,970,930,885],
"北屯區":[1060,1040,1025,995,970,945,920,880,840],
"南屯區":[1060,1040,1025,995,970,945,920,880,840],
"北區":[1045,1030,1010,985,960,935,905,870,830],
"西區":[1045,1030,1010,985,960,935,905,870,830],
"中區":[1010,995,975,950,925,900,875,840,800],
"東區":[1010,995,975,950,925,900,875,840,800],
"南區":[985,970,955,930,905,880,855,820,780],
"烏日區":[940,925,905,885,860,835,815,780,745],
"大里區":[915,900,885,860,840,815,795,760,725],
"潭子區":[915,900,885,860,840,815,795,760,725],
"大雅區":[890,875,860,840,815,795,770,740,705],
"太平區":[890,875,860,840,815,795,770,740,705],
"沙鹿區":[890,875,860,840,815,795,770,740,705],
"后里區":[855,840,825,805,785,760,740,710,675],
"大肚區":[840,830,815,795,775,750,730,700,665],
"神岡區":[840,830,815,795,775,750,730,700,665],
"豐原區":[840,830,815,795,775,750,730,700,665],
"梧棲區":[830,815,805,780,760,740,720,690,660],
"龍井區":[830,815,805,780,760,740,720,690,660],
"大甲區":[780,770,755,735,720,700,680,650,620],
"外埔區":[720,710,700,680,660,645,625,600,570],
"石岡區":[720,710,700,680,660,645,625,600,570],
"霧峰區":[720,710,700,680,660,645,625,600,570],
"清水區":[590,580,570,555,540,525,510,490,470],
"新社區":[480,475,465,455,445,430,420,400,380],
"東勢區":[480,475,465,455,445,430,420,400,380],
"其它":[385,380,375,365,355,345,335,320,305]
};

const HOUSE_TABLE = {
"西屯區":[940,925,905,885,860,835,815,780,745],
"北屯區":[900,885,870,850,830,805,780,750,715],
"南屯區":[900,885,870,850,830,805,780,750,715],
"北區":[890,875,860,840,815,795,770,740,705],
"西區":[890,875,860,840,815,795,770,740,705],
"中區":[830,815,805,780,760,740,720,690,660],
"東區":[830,815,805,780,760,740,720,690,660],
"烏日區":[830,815,805,780,760,740,720,690,660],
"南區":[780,770,755,735,720,700,680,650,620],
"大里區":[770,760,745,725,705,685,670,640,610],
"太平區":[770,760,745,725,705,685,670,640,610],
"潭子區":[770,760,745,725,705,685,670,640,610],
"豐原區":[770,760,745,725,705,685,670,640,610],
"后里區":[675,665,650,635,620,600,585,560,535],
"沙鹿區":[675,665,650,635,620,600,585,560,535],
"龍井區":[675,665,650,635,620,600,585,560,535],
"大肚區":[660,650,640,625,605,590,575,550,525],
"大雅區":[660,650,640,625,605,590,575,550,525],
"神岡區":[660,650,640,625,605,590,575,550,525],
"梧棲區":[600,590,580,565,550,535,520,500,475],
"清水區":[580,570,560,545,530,515,500,480,460],
"大甲區":[565,555,550,535,520,505,490,470,450],
"外埔區":[505,500,490,475,465,450,440,420,400],
"霧峰區":[505,500,490,475,465,450,440,420,400],
"石岡區":[495,485,480,465,455,440,430,410,390],
"東勢區":[460,450,445,430,420,410,400,380,365],
"新社區":[445,440,430,420,410,400,385,370,355],
"其它":[375,370,360,355,345,335,325,310,295]
};

// 屋齡區間：0–4, 5–9, 10–14, 15–19, 20–24, 25–29, 30–34, 35–39, 40+
const AGE_BANDS=[4,9,14,19,24,29,34,39,999];
const AGE_LABELS=["0–4","5–9","10–14","15–19","20–24","25–29","30–34","35–39","40+"];

function bandIndex(age){
  for(let i=0;i<AGE_BANDS.length;i++){
    if(age<=AGE_BANDS[i]) return i;
  }
  return AGE_BANDS.length-1;
}

document.getElementById("form").onsubmit = (e) => {
  e.preventDefault();

  const d = document.getElementById("district").value;
  const a = Number(document.getElementById("age").value);
  const p = Number(document.getElementById("ping").value);
  const r = Number(document.getElementById("rent").value);

  const decoPct = Number(document.getElementById("deco").value); // 0/3/5
  const areaPct = Number(document.getElementById("area").value); // 0/3/5
  const equipInput = Number(document.getElementById("equip").value || 0);

  const isStudio = p <= 15;                 // 自動判斷套房/非套房（不顯示）
  const limit = isStudio ? 21000 : 35000;   // 上限規則
  const table = isStudio ? STUDIO_TABLE : HOUSE_TABLE;

  const res = document.getElementById("result");
  const det = document.getElementById("detail");

  // 上限直接擋
  if(r > limit){
    res.textContent = "無法承作";
    res.className = "result warn";
    det.textContent = `${isStudio ? "套房" : "非套房"}租金上限 ${limit.toLocaleString()} 元`;
    return;
  }

  const row = table[d];
  if(!row){
    res.textContent = "";
    res.className = "result";
    det.textContent = "找不到此行政區的單價資料。";
    return;
  }

  const idx = bandIndex(a);
  const unit = row[idx]; // 該屋齡單價（顯示與計算一致）
  const max = Math.ceil(unit * p); // 最高租金（無條件進位整數）
  const pass = max >= r;

  const commonInfo =
    `行政區：<b>${d}</b><br>`+
    `屋齡區間：<b>${AGE_LABELS[idx]} 年</b><br>`+
    `該屋齡單價：<b>${unit}</b>`;

  if(pass){
    res.textContent = "O";
    res.className = "result ok";
    det.innerHTML = commonInfo;
    return;
  }

  // 未通過才顯示額外加分
  res.textContent = "X";
  res.className = "result warn";

  const equipCap = isStudio ? 1000 : 2000;
  const equipBonus = Math.min(Math.max(Math.ceil(equipInput),0), equipCap);

  const decoBonus = Math.ceil(max * (decoPct/100));
  const areaBonus = Math.ceil(max * (areaPct/100));

  const bonusTotal = decoBonus + areaBonus + equipBonus;
  const max2 = max + bonusTotal;
  const pass2 = max2 >= r;

  det.innerHTML =
    commonInfo + "<br>" +
    `最高租金：<b>${max.toLocaleString()}</b><br>`+
    `<div class="bonus-box">`+
      `<b>額外加分（依規定）</b><br>`+
      `‧ 室內裝修（${decoPct}%）：<b>${decoBonus.toLocaleString()}</b> 元<br>`+
      `‧ 區位（${areaPct}%）：<b>${areaBonus.toLocaleString()}</b> 元<br>`+
      `‧ 設備（上限 ${equipCap.toLocaleString()}）：<b>${equipBonus.toLocaleString()}</b> 元<br>`+
      `合計加分：<b>${bonusTotal.toLocaleString()}</b> 元<br>`+
      `加分後最高租金：<b>${max2.toLocaleString()}</b> 元<br>`+
      `加分後判斷：<b style="color:${pass2 ? "green" : "red"}">${pass2 ? "O" : "X"}</b>`+
    `</div>`;
};

// tooltip mobile support
document.querySelectorAll(".tooltip").forEach(t=>{
  t.addEventListener("click", (e)=>{
    e.stopPropagation();
    t.classList.toggle("show");
  });
});
document.body.addEventListener("click", ()=>{
  document.querySelectorAll(".tooltip").forEach(t=>t.classList.remove("show"));
});
</script>

</body>
</html>
