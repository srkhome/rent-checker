<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>租金區間試算表</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,"PingFang TC","Heiti TC",sans-serif;margin:20px}
    label{display:block;margin-top:10px;font-size:14px}
    input,select,button{padding:6px 10px;font-size:14px;margin-top:4px}
    button{cursor:pointer}
    fieldset{border:1px solid #ddd;border-radius:10px;padding:12px;margin-top:12px}
    legend{font-size:13px;color:#555;padding:0 6px}
    .result{margin-top:20px;font-size:40px;font-weight:bold}
    .ok{color:green}
    .warn{color:red}
    .detail{margin-top:8px;font-size:16px;color:#333;line-height:1.8}
    .bonus-block{border:2px solid #f39c12;background:#fff8e6;padding:10px;margin-top:15px;border-radius:8px}
    .muted{color:#666}
    .note{margin-top:20px;color:red;font-size:14px;font-weight:bold}

    /* 浮動說明框（tooltip） */
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: pointer;
      color: #3498db;
      font-weight: bold;
      margin-right: 8px;
    }
    .tooltip .tooltip-text {
      visibility: hidden;
      width: 280px;
      background: #333;
      color: #fff;
      text-align: left;
      border-radius: 8px;
      padding: 10px;
      position: absolute;
      z-index: 10;
      top: 25px;
      left: 0;
      opacity: 0;
      transition: opacity 0.25s;
      line-height: 1.6;
      font-size: 13px;
    }
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    .tooltip.show .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>租金區間試算表</h1>

  <form id="rentForm">
    <label>行政區
      <select id="district" required>
        <option value="">— 請選擇 —</option>
        <option>西屯區</option>
        <option>北屯區</option>
        <option>南屯區</option>
        <option>北區</option>
        <option>中區</option>
        <option>西區</option>
        <option>東區</option>
        <option>烏日區</option>
        <option>大里區</option>
        <option>太平區</option>
        <option>潭子區</option>
        <option>豐原區</option>
        <option>后里區</option>
        <option>沙鹿區</option>
        <option>龍井區</option>
        <option>大肚區</option>
        <option>梧棲區</option>
        <option>清水區</option>
        <option>大甲區</option>
        <option>外埔區</option>
        <option>新社區</option>
        <option>石岡區</option>
        <option>東勢區</option>
        <option>和平區</option>
        <option>其它</option>
      </select>
    </label>

    <label>屋齡（年）
      <input id="age" type="number" min="0" max="200" required>
    </label>

    <label>坪數（可輸入小數點兩位）
      <input id="pings" type="number" min="0" step="0.01" required>
    </label>

    <label>現在租金
      <input id="currentRent" type="number" min="0" step="1" required>
    </label>

    <fieldset>
      <legend>額外加分（另外顯示，不與原本金額混合）</legend>

      <label>室內裝修（依表三）
        <select id="deco">
          <option value="0">未裝修（0%）</option>
          <option value="3">簡易裝修（3%）</option>
          <option value="5">中等裝修（5%）</option>
        </select>
      </label>

      <label>區位（依表二）
        <select id="areaLevel">
          <option value="0">中下區位（0%）</option>
          <option value="3">中上區位（3%）</option>
          <option value="5">優質區位（5%）</option>
        </select>
      </label>

      <label>設備調整金額（元／月，依規定上限：<span id="equipCapLabel">依坪數自動判斷</span>）
        <input id="equip" type="number" min="0" step="1" value="0">
      </label>

      <div class="muted">
        說明：裝修與區位以「最高租金」為基礎計算百分比，加分金額採整數（無條件進位）；
        設備調整金額依原表逐項累計（冷氣、冰箱、洗衣機、家具等），本工具僅填入合計後金額，
        並以套房 1,000 元／月、非套房 2,000 元／月為上限。
      </div>

      <div style="margin-top: 10px; font-size: 14px;">
        <b>加分規則說明：</b><br>

        <div class="tooltip">
          區位 ℹ️
          <span class="tooltip-text">
            <b>區位調整（依原始資料表二）</b><br>
            ‧ 優質區位：+5%<br>
            ─ 生活機能佳、商圈完整（市場、賣場、百貨）、<br>
            &nbsp;&nbsp;交通便捷（臨捷運／車站／主要幹道）、<br>
            &nbsp;&nbsp;鄰近學區、醫療機構、公園綠地等，<br>
            &nbsp;&nbsp;符合原表所列多項優勢者。<br><br>
            ‧ 中上區位：+3%<br>
            ─ 一般住宅區，生活機能尚稱便利，<br>
            &nbsp;&nbsp;部分設施距離較遠或密度較低。<br><br>
            ‧ 中下區位：0%<br>
            ─ 位於邊陲或生活機能明顯不足，<br>
            &nbsp;&nbsp;交通及周邊設施條件較差。<br><br>
            ※ 依原則以「最高租金」為基數，按 0 / 3 / 5 % 調整。
          </span>
        </div>
        <br>

        <div class="tooltip">
          室內裝修 ℹ️
          <span class="tooltip-text">
            <b>室內裝修調整（依原始資料表三）</b><br>
            ‧ 中等裝修：+5%<br>
            ─ 全室裝修完整，含天花板、燈具配置、<br>
            &nbsp;&nbsp;系統櫃或固定收納設備、室內地坪鋪設、<br>
            &nbsp;&nbsp;浴室及廚房設備完善等。<br><br>
            ‧ 簡易裝修：+3%<br>
            ─ 以油漆粉刷、局部修繕、<br>
            &nbsp;&nbsp;簡單天花板或部分室內裝修為主，<br>
            &nbsp;&nbsp;設備水準較中等裝修為低。<br><br>
            ‧ 未裝修：0%<br>
            ─ 僅具備基本結構與基本建材，<br>
            &nbsp;&nbsp;未做額外室內裝潢裝修。<br><br>
            ※ 以「最高租金」為基數，按 0 / 3 / 5 % 計算。
          </span>
        </div>
        <br>

        <div class="tooltip">
          設備上限 ℹ️
          <span class="tooltip-text">
            <b>設備調整金額（依原始資料表四）</b><br>
            ‧ 設備項目：依原表列舉<br>
            ─ 如冷氣機、冰箱、洗衣機、熱水器、<br>
            &nbsp;&nbsp;床組、衣櫃、書桌椅、網路、有線電視等，<br>
            &nbsp;&nbsp;各項設備可加計一定金額。<br><br>
            ‧ 合計上限：<br>
            ─ 套房：設備調整金額合計最高以 1,000 元／月為上限。<br>
            ─ 非套房：設備調整金額合計最高以 2,000 元／月為上限。<br><br>
            ※ 本工具僅輸入「合計後設備金額」，<br>
            &nbsp;&nbsp;並自動套用 1,000 / 2,000 元上限規定。
          </span>
        </div>
      </div>
    </fieldset>

    <button type="submit">送出</button>
  </form>

  <div id="result" class="result"></div>
  <div id="detail" class="detail"></div>
  <div id="note" class="note"></div>

<script>
const STUDIO_TABLE = {
"西屯區":[1110,1090,1070,1045,1015,990,960,920,875],
"北屯區":[1120,1100,1080,1055,1025,1000,970,930,885],
"南屯區":[1060,1040,1025,995,970,945,920,880,840],
"北區":[1045,1030,1010,985,960,935,905,870,830],
"中區":[1010,995,975,950,925,900,875,840,800],
"西區":[1010,995,975,950,925,900,875,840,800],
"東區":[1010,995,975,950,925,900,875,840,800],
"烏日區":[940,925,905,885,860,835,815,780,745],
"大里區":[955,900,885,860,840,815,795,760,725],
"太平區":[915,900,885,860,840,815,795,760,725],
"潭子區":[900,875,860,840,815,795,770,740,705],
"豐原區":[900,875,860,840,815,795,770,740,705],
"后里區":[855,840,825,805,785,760,740,710,675],
"沙鹿區":[870,855,840,820,800,780,755,720,690],
"龍井區":[870,855,840,820,800,780,755,720,690],
"大肚區":[830,815,805,780,760,740,720,690,660],
"梧棲區":[840,830,815,795,775,750,730,700,665],
"清水區":[840,830,815,795,775,750,730,700,665],
"大甲區":[720,710,700,680,660,645,625,600,570],
"外埔區":[720,710,700,680,660,645,625,600,570],
"新社區":[485,480,475,465,455,440,430,410,390],
"石岡區":[590,580,570,555,540,525,510,490,470],
"東勢區":[590,580,570,555,540,525,510,490,470],
"和平區":[480,475,465,455,445,430,420,400,380],
"其它":[385,380,375,365,355,345,335,320,305]
};

const HOUSE_TABLE = {
"西屯區":[940,925,905,885,860,835,815,780,745],
"北屯區":[900,885,870,850,830,805,780,750,715],
"南屯區":[900,885,870,850,830,805,780,750,715],
"北區":[890,875,860,840,815,795,770,740,705],
"中區":[890,875,860,840,815,795,770,740,705],
"西區":[830,815,805,780,760,740,720,690,660],
"東區":[830,815,805,780,760,740,720,690,660],
"烏日區":[830,815,805,780,760,740,720,690,660],
"大里區":[780,770,755,735,720,700,680,650,620],
"太平區":[770,760,745,725,705,685,670,640,610],
"潭子區":[770,760,745,725,705,685,670,640,610],
"豐原區":[770,760,745,725,705,685,670,640,610],
"后里區":[665,650,635,620,600,585,560,535,535],
"沙鹿區":[660,650,640,625,605,590,575,550,525],
"龍井區":[660,650,640,625,605,590,575,550,525],
"大肚區":[590,580,570,555,540,525,510,480,460],
"梧棲區":[660,650,640,625,605,590,575,550,525],
"清水區":[600,590,580,565,550,535,520,500,475],
"大甲區":[565,555,550,535,520,500,490,470,450],
"外埔區":[505,500,490,475,465,450,440,420,400],
"新社區":[445,440,430,420,410,400,385,370,355],
"石岡區":[505,500,490,475,465,450,440,420,400],
"東勢區":[495,485,480,465,455,440,430,410,390],
"和平區":[445,440,430,420,410,400,385,370,355],
"其它":[375,370,360,355,345,335,325,310,295]
};

// 年齡對應欄位：0–4, 5–9, 10–14, 15–19, 20–24, 25–29, 30–34, 35–39, 40+
const AGE_BANDS = [4,9,14,19,24,29,34,39,999];

function bandIndex(age){
  for(let i=0;i<AGE_BANDS.length;i++){
    if(age<=AGE_BANDS[i]) return i;
  }
  return AGE_BANDS.length-1;
}

document.getElementById("rentForm").addEventListener("submit", e => {
  e.preventDefault();

  const dist    = document.getElementById("district").value;
  const age     = Number(document.getElementById("age").value);
  const pings   = parseFloat(document.getElementById("pings").value);
  const current = Number(document.getElementById("currentRent").value);

  const decoPct = parseFloat(document.getElementById("deco").value) || 0;
  const areaPct = parseFloat(document.getElementById("areaLevel").value) || 0;
  let   equipInput = Number(document.getElementById("equip").value) || 0;

  const resEl    = document.getElementById("result");
  const detailEl = document.getElementById("detail");
  const noteEl   = document.getElementById("note");

  // 依坪數自動判斷：套房 / 非套房
  const isStudio = pings <= 15 ? "studio" : "house";
  const table    = isStudio === "studio" ? STUDIO_TABLE : HOUSE_TABLE;
  const upperLimit = isStudio === "studio" ? 21000 : 35000;

  document.getElementById("equipCapLabel").textContent =
    isStudio === "studio" ? "上限 1,000 元" : "上限 2,000 元";

  // 超過最高租金上限 → 直接無法承作
  if(current > upperLimit){
    resEl.textContent = "無法承作";
    resEl.className   = "result warn";
    detailEl.innerHTML =
      `（${isStudio==="studio"?"套房":"非套房"}租金上限 ${upperLimit.toLocaleString()} 元，現在租金 <b>${current.toLocaleString()}</b> 元）`;
    noteEl.textContent = "以上試算結果僅供參考，最後結果將由審查單位認定";
    return;
  }

  const idx = bandIndex(age);
  const row = table[dist];

  if(!row){
    resEl.textContent = "";
    detailEl.textContent = "找不到此行政區的單價資料。";
    noteEl.textContent = "";
    return;
  }

  const priceBand = row[idx];   // 該屋齡單價
  const priceBase = row[0];     // 0–4 年基準
  const rateFromBase = priceBase ? (priceBand/priceBase - 1) : 0;

  const highest = Math.ceil(priceBand * pings); // 最高租金（進位）
  const pass    = highest >= current;

  resEl.textContent = pass ? "O" : "X";
  resEl.className   = "result " + (pass ? "ok" : "warn");

  let html =
    `租金區間（每坪）：<b>${priceBand}</b><br>`+
    `租金區間表（0–4 年基準，元／坪）：<b>${priceBase}</b><br>`+
    `調等率：<b>${(rateFromBase*100).toFixed(2)}%</b><br>`+
    (pass
      ? `現在租金：<b>${current.toLocaleString()}</b> 元`
      : `坪數：<b>${pings.toFixed(2)}坪</b><br>`+
        `最高租金（無條件進位）：<b>${highest.toLocaleString()}</b> 元<br>`+
        `現在租金：<b>${current.toLocaleString()}</b> 元`
    );

  // 只有未通過時，才依規定顯示額外加分
  if(!pass){
    const decoBonus  = Math.ceil(highest * (decoPct/100));   // 室內裝修
    const areaBonus  = Math.ceil(highest * (areaPct/100));   // 區位
    const equipCap   = isStudio === "studio" ? 1000 : 2000;  // 規定上限
    const equipBonus = Math.min(Math.ceil(Math.max(equipInput,0)), equipCap);
    const totalBonus = decoBonus + areaBonus + equipBonus;
    const highestPlus= highest + totalBonus;
    const passPlus   = highestPlus >= current;

    html +=
      `<div class="bonus-block">`+
      `<u>額外加分（依區位／裝修／設備規定，另行顯示）</u><br>`+
      `‧ 室內裝修加分：<b>${decoBonus.toLocaleString()}</b> 元（${decoPct}%）<br>`+
      `‧ 區位加分：<b>${areaBonus.toLocaleString()}</b> 元（${areaPct}%）<br>`+
      `‧ 設備加分（上限 ${equipCap.toLocaleString()}）：<b>${equipBonus.toLocaleString()}</b> 元<br>`+
      `合計加分：<b>${totalBonus.toLocaleString()}</b> 元<br>`+
      `最高租金（含加分）：<b>${highestPlus.toLocaleString()}</b> 元<br>`+
      `加分後判斷：<b style="color:${passPlus?"green":"red"}">${passPlus?"O":"X"}</b>`+
      `</div>`;
  }

  detailEl.innerHTML = html;
  noteEl.textContent = "以上試算結果僅供參考，最後結果將由審查單位認定";
});

// 手機：點擊 tooltip 開關
document.querySelectorAll(".tooltip").forEach(tip => {
  tip.addEventListener("click", function (e) {
    e.stopPropagation();
    this.classList.toggle("show");
  });
});

// 點擊其他地方關閉 tooltip
document.body.addEventListener("click", () => {
  document.querySelectorAll(".tooltip").forEach(tip => tip.classList.remove("show"));
});
</script>
</body>
</html>
